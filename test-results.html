<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ - LIBERAL GROUP</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="images/Site-avatar.png">
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: 'Midnight', monospace;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(255, 0, 0, 0.3);
            padding-bottom: 20px;
        }
        
        h1 {
            color: red;
            font-weight: 100;
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .back-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid red;
            color: red;
            padding: 12px 25px;
            cursor: pointer;
            font-family: 'Midnight';
            font-size: 16px;
        }
        
        .refresh-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ffa500;
            color: #ffa500;
            padding: 12px 25px;
            cursor: pointer;
            font-family: 'Midnight';
            font-size: 16px;
        }
        
        .stats {
            color: #ff6363;
            font-size: 14px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            border: 1px solid rgba(255, 0, 0, 0.3);
            padding: 20px;
            background: rgba(1, 1, 1, 0.3);
            transition: transform 0.3s;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            border-color: red;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed rgba(255, 0, 0, 0.3);
        }
        
        .username {
            color: red;
            font-size: 18px;
            font-weight: bold;
        }
        
        .date {
            color: #ff6363;
            font-size: 12px;
        }
        
        .ideology {
            color: #ffa500;
            text-align: center;
            margin: 10px 0;
            padding: 5px;
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
        }
        
        .axes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .axis-item {
            font-size: 13px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .axis-label {
            color: #aaa;
        }
        
        .axis-value {
            color: white;
            font-weight: bold;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            grid-column: 1 / -1;
        }
        
        .empty-state h2 {
            color: red;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            grid-column: 1 / -1;
            color: #ffa500;
        }
        
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .back-btn, .refresh-btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h1>
            <p style="color: #ff6363;">–í—Å–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞</p>
        </div>
        
        <div class="controls">
            <button class="back-btn" onclick="window.location.href='index.html'">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
            <div class="stats" id="statsInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button class="refresh-btn" onclick="loadResults()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        
        <div id="resultsContainer" class="results-grid">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE ===
        const SUPABASE_URL = 'https://eqkanneloooeopkhhpuc.supabase.co'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVxa2FubmVsb29vZW9wa2hocHVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MDk1MDgsImV4cCI6MjA4MDQ4NTUwOH0.EL7ZR9iyRSPIOYudaFWDQC4z1hXzu0PPtE1McoVvGp0'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∫–ª—é—á
        // =============================
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let isLoading = false;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', loadResults);
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        async function loadResults() {
            if (isLoading) return;
            
            isLoading = true;
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</div>';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ Supabase
                const { data: results, error } = await supabase
                    .from('test_results')
                    .select('*')
                    .eq('published', true)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('statsInfo').innerHTML = 
                    `üìà –í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${results ? results.length : 0}`;
                
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                if (!results || results.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h2>–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h2>
                            <p style="color: #ff6363; margin-bottom: 30px;">
                                –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ–ø—É–±–ª–∏–∫—É–µ—Ç —Å–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!
                            </p>
                            <button onclick="window.location.href='index.html'" 
                                    style="padding: 15px 30px; background: rgba(255,0,0,0.2); 
                                           border: 1px solid red; color: red; cursor: pointer; 
                                           font-family: 'Midnight';">
                                –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                container.innerHTML = results.map(result => `
                    <div class="result-card">
                        <div class="card-header">
                            <span class="username">${escapeHtml(result.username)}</span>
                            <span class="date">${formatDate(result.created_at)}</span>
                        </div>
                        
                        <div class="ideology">${escapeHtml(result.ideology)}</div>
                        
                        <div class="axes">
                            <div class="axis-item">
                                <span class="axis-label">–†–∞–≤–µ–Ω—Å—Ç–≤–æ:</span>
                                <span class="axis-value">${result.equality.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–†—ã–Ω–∫–∏:</span>
                                <span class="axis-value">${result.wealth.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–ú–∏—Ä:</span>
                                <span class="axis-value">${result.peace.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–ù–∞—Ü–∏—è:</span>
                                <span class="axis-value">${result.might.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–°–≤–æ–±–æ–¥–∞:</span>
                                <span class="axis-value">${result.liberty.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–ê–≤—Ç–æ—Ä–∏—Ç–µ—Ç:</span>
                                <span class="axis-value">${result.authority.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                                <span class="axis-value">${result.progress.toFixed(1)}%</span>
                            </div>
                            <div class="axis-item">
                                <span class="axis-label">–¢—Ä–∞–¥–∏—Ü–∏—è:</span>
                                <span class="axis-value">${result.tradition.toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                        <p style="color: #ff4444;">${error.message}</p>
                        <button onclick="loadResults()" 
                                style="padding: 15px 30px; background: rgba(255,0,0,0.2); 
                                       border: 1px solid red; color: red; cursor: pointer; 
                                       margin-top: 20px;">
                            –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
            } finally {
                isLoading = false;
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (!isLoading && document.visibilityState === 'visible') {
                loadResults();
            }
        }, 30000);
    </script>
</body>
</html>
