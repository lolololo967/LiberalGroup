<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π —Å–∞–π—Ç —Å –∞–¥–º–∏–Ω–∫–æ–π</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        
        .admin-login-btn { 
            position: fixed; top: 20px; right: 20px; 
            background: #007bff; color: white; border: none; 
            padding: 10px 20px; border-radius: 5px; cursor: pointer; 
        }
        
        .admin-panel { 
            position: fixed; top: 70px; right: 20px; background: white; 
            border: 2px solid #007bff; padding: 15px; border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 1000;
        }
        
        [contenteditable="true"] { border: 1px dashed #007bff; padding: 5px; margin: 2px; }
        
        .modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); display: flex; justify-content: center; 
            align-items: center; z-index: 2000; 
        }
        
        .modal-content { background: white; padding: 30px; border-radius: 8px; }
        
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ -->
    <button id="adminLoginBtn" class="admin-login-btn">üîê –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤</button>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <header>
        <h1 data-content-key="site_title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞—à —Å–∞–π—Ç</h1>
    </header>

    <main>
        <section class="section">
            <h2 data-content-key="welcome_title">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</h2>
            <p data-content-key="welcome_text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞—à —Å–∞–π—Ç! –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
        </section>

        <section class="section">
            <h2 data-content-key="about_title">–û –Ω–∞—Å</h2>
            <p data-content-key="about_text">–ú—ã - –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤, –∑–∞–Ω–∏–º–∞—é—â–∞—è—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–µ–±-—Å–∞–π—Ç–æ–≤.</p>
        </section>

        <section class="section">
            <h2 data-content-key="contact_title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
            <p data-content-key="contact_text">Email: info@example.com | –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67</p>
        </section>
    </main>

    <footer>
        <p data-content-key="footer_text">¬© 2024 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
    </footer>

    <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
    <div id="adminPanel" class="admin-panel hidden">
        <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
        <button id="publishBtn">üì¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        <button id="logoutBtn" style="margin-top: 10px;">–í—ã–π—Ç–∏</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <h3>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="width: 100%; padding: 10px; margin: 10px 0;">
            <button id="loginBtn" style="width: 100%; padding: 10px; background: #007bff; color: white; border: none;">–í–æ–π—Ç–∏</button>
            <button id="cancelBtn" style="width: 100%; padding: 10px; margin-top: 5px; background: #6c757d; color: white; border: none;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase - –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –ó–ù–ê–ß–ï–ù–ò–Ø!
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_KEY = 'your-anon-key';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let isAdmin = false;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        async function loadContent() {
            const { data } = await supabase.from('site_content').select('*');
            if (data) {
                data.forEach(item => {
                    const elements = document.querySelectorAll(`[data-content-key="${item.content_key}"]`);
                    elements.forEach(el => el.textContent = item.content_value);
                });
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        async function saveContent(key, value) {
            await supabase.from('site_content').upsert({ 
                content_key: key, 
                content_value: value 
            });
        }

        // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
        async function publishChanges() {
            const elements = document.querySelectorAll('[data-content-key]');
            for (const element of elements) {
                await saveContent(element.getAttribute('data-content-key'), element.textContent);
            }
            alert('–ò–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã!');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
        async function checkPassword(password) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
            // –î–ª—è –¥–µ–º–æ: –ø–∞—Ä–æ–ª—å "admin123"
            const { data } = await supabase.from('admins').select('*').eq('username', 'admin').single();
            return data && await verifyPassword(password, data.password_hash);
        }

        async function verifyPassword(password, hash) {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –¥–µ–º–æ
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashedPassword = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            
            // –î–ª—è –¥–µ–º–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Ö–µ—à–µ–º "admin123"
            return hashedPassword === '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9';
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        function toggleEditMode(enable) {
            document.querySelectorAll('[data-content-key]').forEach(el => {
                el.contentEditable = enable;
            });
            document.getElementById('adminPanel').classList.toggle('hidden', !enable);
            document.getElementById('adminLoginBtn').style.display = enable ? 'none' : 'block';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            loadContent();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('adminLoginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.remove('hidden');
            });
            
            document.getElementById('loginBtn').addEventListener('click', async () => {
                const password = document.getElementById('adminPassword').value;
                if (await checkPassword(password)) {
                    isAdmin = true;
                    document.getElementById('loginModal').classList.add('hidden');
                    toggleEditMode(true);
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                }
            });
            
            document.getElementById('cancelBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.add('hidden');
            });
            
            document.getElementById('publishBtn').addEventListener('click', publishChanges);
            
            document.getElementById('logoutBtn').addEventListener('click', () => {
                isAdmin = false;
                toggleEditMode(false);
                loadContent(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
            });
        });
    </script>
</body>
</html>
