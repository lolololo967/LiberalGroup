<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π —Å–∞–π—Ç —Å –∞–¥–º–∏–Ω–∫–æ–π</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .hidden { display: none !important; }
        .admin-btn { position: fixed; top: 20px; right: 20px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .admin-panel { position: fixed; top: 70px; right: 20px; background: white; padding: 15px; border: 2px solid #007bff; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        [contenteditable="true"] { border: 1px dashed #007bff; padding: 5px; margin: 2px; background: #f8f9fa; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 8px; min-width: 300px; }
        .input-field { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        .btn { padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .status { margin-top: 10px; font-size: 14px; text-align: center; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <button id="adminLoginBtn" class="admin-btn">üîê –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤</button>

    <h1 data-content-key="title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç</h1>
    
    <div data-content-key="content">
        <p>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —á—Ç–æ–±—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.</p>
    </div>

    <div data-content-key="about">
        <h2>–û –Ω–∞—Å</h2>
        <p>–ú—ã –ª—É—á—à–∞—è –∫–æ–º–ø–∞–Ω–∏—è –≤ —Å–≤–æ–µ–º —Ä–æ–¥–µ!</p>
    </div>

    <div id="adminPanel" class="admin-panel hidden">
        <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
        <button id="publishBtn" class="btn btn-success">üì¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        <button id="logoutBtn" class="btn btn-danger">üö™ –í—ã–π—Ç–∏</button>
        <div id="statusMessage" class="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
    </div>

    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <h3>üîê –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <input type="password" id="passwordInput" class="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            <button id="loginBtn" class="btn btn-primary" style="width: 100%;">–í–æ–π—Ç–∏</button>
            <button id="cancelBtn" class="btn btn-secondary" style="width: 100%;">–û—Ç–º–µ–Ω–∞</button>
            <div id="loginMessage" class="status"></div>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –ó–ù–ê–ß–ï–ù–ò–Ø –ù–ê –†–ï–ê–õ–¨–ù–´–ï –ò–ó SUPABASE!
        // –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª—ã
        const SUPABASE_URL = 'https://pwawgeyxzjntystktciz.supabase.co'; // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3YXdnZXl4empudHlzdGt0Y2l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMjU2NTQsImV4cCI6MjA3NDkwMTY1NH0.nS4TpZT7hq1PW4lLUiDccUmJSobnXWm1GFTWskYy8jI'; // –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª—é—á

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let isAdmin = false;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, type = 'info') {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = 'status ' + type;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Ö–æ–¥–∞
        function showLoginMessage(message, type = 'error') {
            const messageElement = document.getElementById('loginMessage');
            messageElement.textContent = message;
            messageElement.className = 'status ' + type;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function loadContent() {
            try {
                showStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...');
                
                const { data, error } = await supabase
                    .from('site_content')
                    .select('*');

                if (error) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
                }

                if (data && data.length > 0) {
                    data.forEach(item => {
                        const elements = document.querySelectorAll(`[data-content-key="${item.content_key}"]`);
                        elements.forEach(element => {
                            element.textContent = item.content_value;
                        });
                    });
                    showStatus('–ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                } else {
                    showStatus('–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        async function saveContent(key, value) {
            try {
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:', key, '->', value);
                
                const { error } = await supabase
                    .from('site_content')
                    .upsert({ 
                        content_key: key, 
                        content_value: value 
                    }, {
                        onConflict: 'content_key'
                    });

                if (error) {
                    console.error('–û—à–∏–±–∫–∞ Supabase:', error);
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
                }
                
                console.log('–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', key);
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                throw error;
            }
        }

        // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
        async function publishChanges() {
            try {
                showStatus('–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π...');
                
                const elements = document.querySelectorAll('[data-content-key]');
                let savedCount = 0;

                for (const element of elements) {
                    const key = element.getAttribute('data-content-key');
                    const value = element.textContent;
                    
                    await saveContent(key, value);
                    savedCount++;
                }

                showStatus(`–£—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ ${savedCount} —ç–ª–µ–º–µ–Ω—Ç–æ–≤!`, 'success');
                
                setTimeout(() => {
                    if (isAdmin) {
                        showStatus('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω');
                    }
                }, 3000);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:', error);
                showStatus('–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
        async function checkPassword(password) {
            try {
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashedPassword = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                
                const correctHash = '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9';
                
                return hashedPassword === correctHash;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è:', error);
                return false;
            }
        }

        // –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function toggleEditMode(enable) {
            const elements = document.querySelectorAll('[data-content-key]');
            
            elements.forEach(element => {
                element.contentEditable = enable;
            });
            
            if (enable) {
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminLoginBtn').style.display = 'none';
                showStatus('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω');
            } else {
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('adminLoginBtn').style.display = 'block';
                showStatus('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–°–∞–π—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. Supabase URL:', SUPABASE_URL);
            
            loadContent();
            
            document.getElementById('adminLoginBtn').addEventListener('click', function() {
                document.getElementById('loginModal').classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                showLoginMessage('');
            });

            document.getElementById('loginBtn').addEventListener('click', async function() {
                const password = document.getElementById('passwordInput').value;
                const loginBtn = document.getElementById('loginBtn');
                
                if (!password) {
                    showLoginMessage('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                    return;
                }
                
                loginBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
                loginBtn.disabled = true;
                
                try {
                    if (await checkPassword(password)) {
                        isAdmin = true;
                        document.getElementById('loginModal').classList.add('hidden');
                        toggleEditMode(true);
                        showLoginMessage('');
                    } else {
                        showLoginMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: admin123');
                    }
                } catch (error) {
                    showLoginMessage('–û—à–∏–±–∫–∞: ' + error.message);
                } finally {
                    loginBtn.textContent = '–í–æ–π—Ç–∏';
                    loginBtn.disabled = false;
                }
            });

            document.getElementById('cancelBtn').addEventListener('click', function() {
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('passwordInput').value = '';
                showLoginMessage('');
            });

            document.getElementById('publishBtn').addEventListener('click', publishChanges);

            document.getElementById('logoutBtn').addEventListener('click', function() {
                isAdmin = false;
                toggleEditMode(false);
                loadContent();
            });

            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginBtn').click();
                }
            });

            document.getElementById('loginModal').addEventListener('click', function(e) {
                if (e.target.id === 'loginModal') {
                    document.getElementById('loginModal').classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
